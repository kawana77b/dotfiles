version: '3'

tasks:
  #################################################
  # common
  #################################################
  default:
    desc: ã‚¿ã‚¹ã‚¯ã®ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
    cmds:
      - task -g -l
    silent: true

  help:
    desc: ã‚¿ã‚¹ã‚¯ã®ã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤º
    summary: |
      ã“ã®ã‚¿ã‚¹ã‚¯ã¯ã€ã‚¿ã‚¹ã‚¯ã®ã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤ºã—ã¾ã™
      ã‚¿ã‚¹ã‚¯åã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€ãã®ã‚¿ã‚¹ã‚¯ã®è©³ç´°ã‚’è¡¨ç¤ºã§ãã¾ã™

      ex) task help -- dotnet:init

    cmds:
      - task -g --summary {{.CLI_ARGS}} --summary
    silent: true

  proj:basic-files:
    desc: .gitignore LICENSE, README.mdã‚’ä½œæˆã™ã‚‹
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - task: proj:create-readme
      - task: proj:gitignore
      - task: proj:license

  proj:gitignore:
    desc: .gitignoreã‚’ä½œæˆã™ã‚‹
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - templ get gitignore

  proj:license:
    desc: LICENSEã‚’ä½œæˆã™ã‚‹
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - templ get license

  proj:create-readme:
    desc: README.mdã‚’ä½œæˆã™ã‚‹
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - cmd: pwsh -Command New-Item README.md
        platforms: ["windows"]
      - cmd: touch README.md
        platforms: ["darwin", "linux"]

  #################################################
  # javascript
  #################################################
  typescript:init:
    desc: typescriptã®åŸºæœ¬ç’°å¢ƒã‚’ä½œæˆã™ã‚‹
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - npm init -y
      - pnpm i -D typescript ts-node
      - curl -s https://raw.githubusercontent.com/tsconfig/bases/main/bases/recommended.json > tsconfig.json
      - cmd: pwsh -Command New-Item src -ItemType Directory
        platforms: ["windows"]
      - cmd: mkdir src
        platforms: ["darwin", "linux"]
      - cmd: pwsh -Command New-Item src/index.ts
        platforms: ["windows"]
      - cmd: touch src/index.ts
        platforms: ["darwin", "linux"]
      - cmd: echo "ğŸ’¡ [NOTE] Please edit 'tsconfig.json'"

  next:init:
    desc: next.jsã®åŸºæœ¬ç’°å¢ƒã‚’ä½œæˆã™ã‚‹
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - pnpm dlx create-next-app@latest

  vite:init:
    desc: viteã®åŸºæœ¬ç’°å¢ƒã‚’ä½œæˆã™ã‚‹
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - pnpm create vite@latest
  
  vite:tailwind:
    desc: viteã§tailwind CSSã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - pnpm install -D tailwindcss postcss autoprefixer
      - pnpm dlx tailwindcss init -p
      - cmd: echo "ğŸ’¡ [NOTE] see https://tailwindcss.com/docs/guides/vite"
        silent: true
      - cmd: echo "ğŸ’¡ [NOTE] Please edit 'tailwind.config.js' and './src/index.css'"
        silent: true

  eslint:init:
    desc: eslintåŠã³prettierã®åŸºæœ¬ç’°å¢ƒã‚’ä½œæˆã™ã‚‹
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - npm init @eslint/config
      # - pnpm install -D prettier eslint-config-prettier
      - cmd: pwsh -Command New-Item prettier.config.js
        platforms: ["windows"]
        ignore_error: true
      - cmd: touch prettier.config.js
        platforms: ["darwin", "linux"]
        ignore_error: true
      - cmd: "echo 'module.exports = { plugins: [] };' > prettier.config.js"
      - cmd: pnpm dlx prettier --write prettier.config.js
      - task: eslint:create-eslintignore
      - cmd: echo ""
        silent: true
      - cmd: echo "ğŸ’¡ [NOTE] Please add 'prettier' to 'extends' in '.eslintrc'"
        silent: true
  
  eslint:create-eslintignore:
    desc: .eslintignoreã‚’ä½œæˆã™ã‚‹
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - echo "!.eslintrc.js" >> .eslintignore
      - echo "dist/*" >> .eslintignore
      - echo "node_modules/*" >> .eslintignore
      - echo "gulpfile.js" >> .eslintignore

  eslint:tailwind:
    desc: tailwind-cssç”¨ã®eslintç’°å¢ƒã‚’ä½œæˆã™ã‚‹
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - pnpm i -D eslint-plugin-tailwindcss
      - pnpm i -D prettier prettier-plugin-tailwindcss
      - cmd: echo "ğŸ’¡ [NOTE] Please add 'plugin:tailwindcss/recommended' to 'extends' in '.eslintrc'"
        silent: true
      - cmd: echo "ğŸ’¡ [NOTE] Please add 'prettier-plugin-tailwindcss' to 'plugins' in 'prettier.config.js'"
        silent: true

  ts-jest:init:
    desc: ts-jestã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - pnpm i -D jest ts-jest @types/jest
      - pnpm dlx ts-jest config:init
      - cmd: echo "ğŸ’¡ [NOTE] Try setting 'jest' to 'npm run test'. 'npm test' should also work"
        silent: true

  storybook:init:
    desc: storybookã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - pnpm dlx storybook@latest init

  plop:init:
    desc: plopã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    dir: '{{.USER_WORKING_DIR}}'
    vars:
      TEMPLATE_FOLDER: templates
    cmds:
      - pnpm i -D plop
      - pnpm dlx plop --init
      - cmd: pwsh -Command New-Item {{.TEMPLATE_FOLDER}} -ItemType Directory
        platforms: ["windows"]
      - cmd: mkdir {{.TEMPLATE_FOLDER}}
        platforms: ["darwin", "linux"]

  #################################################
  # Go
  #################################################
  go:init:
    desc: Goã®åˆæœŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
    dir: '{{.USER_WORKING_DIR}}'
    vars:
      MAKEFILE: Makefile
    preconditions:
      - sh: '[ ! -z {{.CLI_ARGS}} ]'
        msg: "ğŸ’¡ [NOTE] Please specify the project name. cf) go:init -- github.com/foo/bar"
    cmds:
      - cmd: pwsh -Command New-Item main.go
        platforms: ["windows"]
      - cmd: touch main.go
        platforms: ["darwin", "linux"]
      - go mod init {{.CLI_ARGS}}
      - cmd: pwsh -Command New-Item {{.MAKEFILE}}
        platforms: ["windows"]
      - cmd: touch {{.MAKEFILE}}
        platforms: ["darwin", "linux"]
      - curl -s https://raw.githubusercontent.com/github/gitignore/main/Go.gitignore > .gitignore
      - task: proj:create-readme
  
  go:test:
    desc: Goã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - go test -v ./...

  go:install:
    desc: Goã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - go install -ldflags="-s -w" -trimpath

  go:build:
    desc: Goã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - go build -ldflags="-s -w" -trimpath

  #################################################
  # Python
  #################################################
  conda:create:
    desc: pythonã®condaç’°å¢ƒã‚’ä½œæˆã™ã‚‹
    dir: '{{.USER_WORKING_DIR}}'
    preconditions:
      - sh: '[ ! -z {{.NAME}} ] && [ ! -z {{.VERSION}} ]'
        msg: "ğŸ’¡ [NOTE] Please specify the environment name and version. cf) conda:create NAME=foo VERSION=3.11"
    cmds:
      - conda create -n {{.NAME}} python={{.VERSION}}

  conda:delete:
    desc: pythonã®condaç’°å¢ƒã‚’å‰Šé™¤ã™ã‚‹
    dir: '{{.USER_WORKING_DIR}}'
    preconditions:
      - sh: '[ ! -z {{.CLI_ARGS}} ]'
        msg: "ğŸ’¡ [NOTE] Please specify the environment name. cf) conda:delete -- foo"
    cmds:
      - conda remove -n {{.CLI_ARGS}} --all

  venv:create:
    desc: pythonã®venvç’°å¢ƒã‚’ä½œæˆã™ã‚‹
    dir: '{{.USER_WORKING_DIR}}'
    preconditions:
      - sh: '[ ! -z {{.CLI_ARGS}} ]'
        msg: "ğŸ’¡ [NOTE] Please specify the environment name. cf) venv:create -- foo"
    cmds:
      - python -m venv {{.CLI_ARGS}}
      - cmd: echo "ğŸ’¡ [NOTE] Please activate venv '.\{{.CLI_ARGS}}\Scripts\Activate.ps1'"
        silent: true
        platforms: ["windows"]
      - cmd: echo "ğŸ’¡ [NOTE] Please activate venv './{{.CLI_ARGS}}/Scripts/activate'"
        silent: true
        platforms: ["darwin", "linux"]
  
  # pip:install:
  #   platforms: ["linux"]
  #   desc: pythonã®pipã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’requirements.txtã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
  #   summary: |
  #     ã“ã®ã‚¿ã‚¹ã‚¯ã¯ã€pythonã®pipã®å‡ºåŠ›ã‚’requirements.txtã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™
  #     ã“ã®ã‚¿ã‚¹ã‚¯ã¯Linux, åŸºæœ¬çš„ã«Dockerã§ã®ä½¿ç”¨ã‚’æƒ³å®šã—ã¦ã„ã¾ã™
  #     ä»–ã®OSã§ã¯ä½•ã‚‚ã—ã¾ã›ã‚“
  #   dir: '{{.USER_WORKING_DIR}}'
  #   preconditions:
  #     - sh: '[ -f ./requirements.txt ]'
  #       msg: "ğŸ’¡ [NOTE] Please create 'requirements.txt' file. cf) pip:output"
  #   cmds:
  #     - pip install requirements.txt
  
  # pip:output:
  #   platforms: ["linux"]
  #   desc: pythonã®pipã®å‡ºåŠ›ã‚’requirements.txtã«ä¿å­˜ã™ã‚‹
  #   summary: |
  #     ã“ã®ã‚¿ã‚¹ã‚¯ã¯ã€pythonã®pipã®å‡ºåŠ›ã‚’requirements.txtã«ä¿å­˜ã—ã¾ã™
  #     ã“ã®ã‚¿ã‚¹ã‚¯ã¯Linux, åŸºæœ¬çš„ã«Dockerã§ã®ä½¿ç”¨ã‚’æƒ³å®šã—ã¦ã„ã¾ã™
  #     ä»–ã®OSã§ã¯ä½•ã‚‚ã—ã¾ã›ã‚“
  #   dir: '{{.USER_WORKING_DIR}}'
  #   cmds:
  #     - pip freeze > requirements.txt

  #################################################
  # C#
  #################################################
  dotnet:git-files:
    desc: ç¾åœ¨ã®ãƒ•ã‚©ãƒ«ãƒ€ã«C#å‘ã‘ã®.gitignore, .gitattributesã‚’ä½œæˆ
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - dotnet new gitignore
      - curl -s https://raw.githubusercontent.com/github/VisualStudio/master/.gitattributes > .gitattributes

  dotnet:init:
    desc: ç¾åœ¨ã®ãƒ•ã‚©ãƒ«ãƒ€ã«C#ã®template/NUnit csprojã‚’ä½œæˆ
    summary: |
      ã“ã®ã‚¿ã‚¹ã‚¯ã¯ã€ç¾åœ¨ã®ãƒ•ã‚©ãƒ«ãƒ€ã«C#ã®template/NUnit csprojã‚’ä½œæˆã—ã¾ã™
      ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ 'classlib' ã§ã™ãŒã€TEMPLATEå¤‰æ•°ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§å¤‰æ›´ã§ãã¾ã™
      ã¾ãŸã€TARGET_FRAMEWORKå¤‰æ•°ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’å¤‰æ›´ã§ãã¾ã™. ä¾‹ãˆã°ã€'net6.0' ã§ã™

      ex) task -g dotnet:init TEMPLATE=console -- Foo
    dir: '{{.USER_WORKING_DIR}}'
    vars:
      TEMPLATE: '{{default "classlib" .TEMPLATE}}'
      TARGET_FRAMEWORK: '{{default "net6.0" .TARGET_FRAMEWORK}}'
      TEST_PROJ_NAME: '{{.CLI_ARGS}}.Test'
    preconditions:
      - sh: '[ ! -z {{.CLI_ARGS}} ]'
        msg: "ğŸ’¡ [NOTE] Please specify the project name. cf) dotnet:init -- Foo"
    cmds:
      - dotnet new sln
      - task: dotnet:git-files
      - task: proj:create-readme
      - dotnet new {{.TEMPLATE}} -o {{.CLI_ARGS}} -f {{.TARGET_FRAMEWORK}}
      - dotnet sln add {{.CLI_ARGS}}/{{.CLI_ARGS}}.csproj
      - dotnet new nunit -o {{.TEST_PROJ_NAME}} -f {{.TARGET_FRAMEWORK}}
      - dotnet sln add {{.TEST_PROJ_NAME}}/{{.TEST_PROJ_NAME}}.csproj
      - dotnet add {{.TEST_PROJ_NAME}}/{{.TEST_PROJ_NAME}}.csproj reference {{.CLI_ARGS}}/{{.CLI_ARGS}}.csproj
      - dotnet restore
  
  dotnet:init:console:
    desc: ç¾åœ¨ã®ãƒ•ã‚©ãƒ«ãƒ€ã«C#ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã€NUnit.cprojã‚’ä½œæˆ
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - task: dotnet:init
        vars:
          TEMPLATE: console

  #################################################
  # docker
  #################################################
  docker:search-image-tag:official:
    desc: Docker Hubã‹ã‚‰å…¬å¼ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚¿ã‚°ã‚’æ¤œç´¢ã™ã‚‹
    dir: '{{.USER_WORKING_DIR}}'
    summary: |
      å¼•æ•°ã®Docker Hubã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¿ã‚°ã‚’æ¤œç´¢ã—ã¾ã™
      éå…¬å¼ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ docker:search-image-tag ã‚¿ã‚¹ã‚¯ã‚’åˆ©ç”¨ã—ã¦ãã ã•ã„
      å¼•æ•°ã®å€¤ã¯ node ã®ã‚ˆã†ã«ãªã‚Šã¾ã™
    preconditions:
      - sh: '[ ! -z {{.CLI_ARGS}} ]'
        msg: "arugument is required. (image name)"
    cmds:
      - cmd: curl -s https://hub.docker.com/v2/repositories/library/{{.CLI_ARGS}}/tags/?page_size=100 | jq -r .results[].name
        silent: true

  docker:search-image-tag:
    desc: Docker Hubã‹ã‚‰ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚¿ã‚°ã‚’æ¤œç´¢ã™ã‚‹
    summary: |
      å¼•æ•°ã®Docker Hubã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¿ã‚°ã‚’æ¤œç´¢ã—ã¾ã™
      å…¬å¼ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ docker:search-image-tag:official ã‚¿ã‚¹ã‚¯ã‚’åˆ©ç”¨ã—ã¦ãã ã•ã„
      å¼•æ•°ã®å€¤ã¯ bitnami/node ã®ã‚ˆã†ã«ãªã‚Šã¾ã™
    preconditions:
      - sh: '[ ! -z {{.CLI_ARGS}} ]'
        msg: "arugument is required. (image name)"
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - cmd: curl -s https://hub.docker.com/v2/repositories/{{.CLI_ARGS}}/tags/?page_size=100 | jq -r .results[].name
        silent: true

  #################################################
  # Package Manger
  #################################################
  go:pkg-cleanup:
    desc: Goã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤ã™ã‚‹
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - go clean --modcache
      - cmd: echo "package cache cleaned."
        silent: true

  pip:cleanup:
    desc: pipã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤ã™ã‚‹
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - pip cache purge

  npm:cleanup:
    desc: npmã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤ã™ã‚‹
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - npm cache verify

  pnpm:cleanup:
    desc: pnpmã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤ã™ã‚‹
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - pnpm store prune

  nuget:cleanup:
    desc: nugetã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤ã™ã‚‹
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - dotnet nuget locals all --clear

  scoop:cleanup:
    platforms: ["windows"]
    desc: scoopã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤ã™ã‚‹
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - scoop cleanup --cache --all
